const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/echarts-charts-JNHThrTf.js","js/echarts-core-BpdCGbkb.js","js/components-Cvkni8oB.js","js/renderers-DGRfqkvX.js"])))=>i.map(i=>d[i]);
import{_ as N,a as _}from"../assets/index-DAeJX3GH.js";import{a as S}from"./index-xsH4HHeE.js";import{G as W,H as k,I as h,J as H}from"./element-plus-DvFYwbwC.js";import{r as v,j as M,l as j,D as J,e as A,o as x,f as n,H as i,F as s,I as X,a0 as q,_ as U,u as L,U as O,E as K}from"./vue-runtime-ZG-tStbc.js";const Q={class:"overview-container"},Y={class:"card-header"},Z={class:"card-content"},ee={class:"stat-item"},te={class:"stat-item"},ae={class:"card-header"},re={class:"card-header"},oe={__name:"Overview",setup(se){const d=v([]),p=v(null),m=v(null),c=v("water"),f=v(!1),w=v(!1),I=v(!1),T=M(()=>c.value==="water"?"用水量统计":"用电量统计"),R=["周一","周二","周三","周四","周五","周六","周日"],F=a=>{const{water:t,electricity:e}=a.floors.reduce((o,l)=>(l.weeklyUsage.forEach(r=>{o.water+=r.waterUsage,o.electricity+=r.electricityUsage}),o),{water:0,electricity:0});return{totalWaterUsage:t.toFixed(2),totalElectricityUsage:e.toFixed(2)}},P=async()=>{if(window.echarts)return window.echarts;I.value=!0;try{const a=await _(()=>import("./echarts-core-BpdCGbkb.js").then(u=>u.bU),[]),{PieChart:t,LineChart:e}=await _(async()=>{const{PieChart:u,LineChart:C}=await import("./echarts-charts-JNHThrTf.js").then(E=>E.e);return{PieChart:u,LineChart:C}},__vite__mapDeps([0,1])),{TitleComponent:o,TooltipComponent:l,LegendComponent:r,GridComponent:g}=await _(async()=>{const{TitleComponent:u,TooltipComponent:C,LegendComponent:E,GridComponent:G}=await import("./components-Cvkni8oB.js");return{TitleComponent:u,TooltipComponent:C,LegendComponent:E,GridComponent:G}},__vite__mapDeps([2,0,1])),{CanvasRenderer:$}=await _(async()=>{const{CanvasRenderer:u}=await import("./renderers-DGRfqkvX.js");return{CanvasRenderer:u}},__vite__mapDeps([3,1]));return a.use([t,e,o,l,r,g,$]),window.echarts=a,a}finally{I.value=!1}},b=async()=>{try{await P();const a=document.getElementById("pie-chart"),t=document.getElementById("line-chart");a&&t&&(p.value=window.echarts.init(a),m.value=window.echarts.init(t),f.value=!0,y())}catch(a){console.error("初始化图表失败:",a)}},y=()=>{if(!(!f.value||d.value.length===0))try{const a=d.value.map(e=>({value:c.value==="water"?parseFloat(e.totalWaterUsage):parseFloat(e.totalElectricityUsage),name:e.name})),t=d.value.map(e=>{const o=[0,0,0,0,0,0,0];return e.floors.forEach(l=>{l.weeklyUsage.forEach((r,g)=>{o[g]+=c.value==="water"?r.waterUsage:r.electricityUsage})}),{name:e.name,type:"line",data:o.map(l=>parseFloat(l.toFixed(1))),smooth:!0,showSymbol:!0}});p.value.setOption({title:{text:"各教学楼占比",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:d.value.map(e=>e.name)},series:[{name:c.value==="water"?"用水量(吨)":"用电量(度)",type:"pie",radius:"50%",data:a,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),m.value.setOption({title:{left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{const o=c.value==="water"?"吨":"度";return e.reduce((l,r)=>`${l}${r.marker} ${r.seriesName}: ${r.value}${o}<br/>`,`${e[0].axisValue}<br/>`)}},legend:{data:d.value.map(e=>e.name),bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:R},yAxis:{type:"value",name:c.value==="water"?"用水量(吨)":"用电量(度)"},series:t})}catch(a){console.error("更新图表时出错:",a)}},D=async()=>{if(!w.value){w.value=!0;try{const{data:a}=await S.get("http://localhost:3000/buildings"),t=Array.isArray(a)?a:[];d.value=t.map(e=>({name:e.name,floors:e.floors||[],...F(e)})),f.value?y():await b()}catch(a){console.error("Error fetching data:",a),H.error("数据加载失败")}finally{w.value=!1}}},z=()=>{y()},V=()=>{p.value&&p.value.resize(),m.value&&m.value.resize()};let B;return j(()=>{D(),B=setInterval(D,5e3),window.addEventListener("resize",V)}),J(()=>{window.removeEventListener("resize",V),p.value&&p.value.dispose(),m.value&&m.value.dispose(),clearInterval(B)}),(a,t)=>{const e=U("el-card"),o=U("el-col"),l=U("el-row");return x(),A("div",Q,[t[5]||(t[5]=n("h3",null,"第一周教学楼用水用电量",-1)),i(l,{gutter:20,class:"card-row",id:"chart-container"},{default:s(()=>[(x(!0),A(X,null,q(d.value,r=>(x(),K(o,{span:6,key:r.name},{default:s(()=>[i(e,{shadow:"hover",class:"building-card"},{header:s(()=>[n("div",Y,[n("span",null,h(r.name),1)])]),default:s(()=>[n("div",Z,[n("div",ee,[n("span",null,"用水量："+h(r.totalWaterUsage)+"吨",1)]),n("div",te,[n("span",null,"用电量："+h(r.totalElectricityUsage)+"度",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),i(l,{gutter:20,class:"chart-row"},{default:s(()=>[i(o,{span:24,class:"chart-switch"},{default:s(()=>[i(L(W),{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=r=>c.value=r),onChange:z},{default:s(()=>[i(L(k),{value:"water"},{default:s(()=>t[1]||(t[1]=[O("用水量")])),_:1}),i(L(k),{value:"electricity"},{default:s(()=>t[2]||(t[2]=[O("用电量")])),_:1})]),_:1},8,["modelValue"])]),_:1}),i(o,{span:12},{default:s(()=>[i(e,{shadow:"hover",class:"chart-card"},{header:s(()=>[n("div",ae,[n("span",null,h(T.value)+"（饼图）",1)])]),default:s(()=>[t[3]||(t[3]=n("div",{id:"pie-chart",class:"chart-container1"},null,-1))]),_:1})]),_:1}),i(o,{span:12},{default:s(()=>[i(e,{shadow:"hover",class:"chart-card"},{header:s(()=>[n("div",re,[n("span",null,h(T.value)+"（折线图）",1)])]),default:s(()=>[t[4]||(t[4]=n("div",{id:"line-chart",class:"chart-container2"},null,-1))]),_:1})]),_:1})]),_:1})])}}},de=N(oe,[["__scopeId","data-v-0c996457"]]);export{de as default};
