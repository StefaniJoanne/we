import{_ as I,u as S}from"../assets/index-DAeJX3GH.js";import{a as P}from"./index-xsH4HHeE.js";import{i as z,a as k}from"./echarts-charts-JNHThrTf.js";import{TitleComponent as N,TooltipComponent as R,LegendComponent as W,GridComponent as G}from"./components-Cvkni8oB.js";import{CanvasRenderer as E}from"./renderers-DGRfqkvX.js";import{E as M,o as V,F as t,H as a,_ as h,f as s,r as p,l as q,q as F}from"./vue-runtime-ZG-tStbc.js";import{I as T}from"./element-plus-DvFYwbwC.js";import{a$ as y,b0 as v,b1 as H}from"./echarts-core-BpdCGbkb.js";H([z,k,N,R,W,G,E]);const j={name:"BuildingDetail",setup(){const w=S(),r=p(""),C=p(""),o=p(""),L={A:"1",B:"2",C:"3",D:"4"},x=p([]),c=p([]),g=p(null),i=p(null),n=p(null),f=p(null),D=async()=>{try{const e=await P.get("http://localhost:3000/buildings"),d=Array.isArray(e.data)?e.data:e.data.buildings,u=L[r.value]||r.value;console.log("转换后的ID:",u),console.log("所有建筑ID:",d.map(b=>b.id));const m=d.find(b=>String(b.id)===String(u));return console.log("找到的建筑:",m),m}catch(e){return console.error("获取建筑数据失败:",e),null}},_=async()=>{r.value=w.params.id,o.value=await D(),o.value&&(C.value=o.value.name,U(),O())},U=()=>{o.value&&(x.value=o.value.floors.map(e=>({floor:`${e.floor}层`,waterUsage:e.monthlyTotal.waterUsage,waterCost:e.monthlyTotal.waterCost})),c.value=o.value.floors.map(e=>({floor:`${e.floor}层`,electricityUsage:e.monthlyTotal.electricityUsage,electricityCost:e.monthlyTotal.electricityCost})))},O=()=>{if(!o.value)return;const e=o.value.floors,d=e.map(l=>({value:l.monthlyTotal.electricityUsage,name:`${l.floor}层`})),u=e[0].weeklyUsage.map(l=>l.day),m=e.map(l=>({name:`${l.floor}层`,type:"line",data:l.weeklyUsage.map($=>$.electricityUsage)})),b=e.map(l=>({value:l.monthlyTotal.waterUsage,name:`${l.floor}层`})),B=e.map(l=>({name:`${l.floor}层`,type:"line",data:l.weeklyUsage.map($=>$.waterUsage)}));v(g.value).setOption({series:[{data:d}]}),v(i.value).setOption({legend:{data:e.map(l=>`${l.floor}层`)},xAxis:{data:u},series:m}),v(n.value).setOption({series:[{data:b}]}),v(f.value).setOption({legend:{data:e.map(l=>`${l.floor}层`)},xAxis:{data:u},series:B})},A=()=>{const e=y(g.value);e.setOption({title:{text:"用电分布",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center"},series:[{name:"用电量(度)",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[]}]});const d=y(i.value);d.setOption({title:{text:"用电趋势",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[],bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",name:"用电量(度)"},series:[]});const u=y(n.value);u.setOption({title:{text:"用水分布",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center"},series:[{name:"用水量(吨)",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[]}]});const m=y(f.value);m.setOption({title:{text:"用水趋势",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[],bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",name:"用水量(吨)"},series:[]}),window.addEventListener("resize",function(){e.resize(),d.resize(),u.resize(),m.resize()})};return q(()=>{A(),_()}),F(()=>w.params.id,(e,d)=>{e!==d&&_()}),{buildingName:C,waterTableData:x,electricityTableData:c,electricityPieChart:g,electricityLineChart:i,waterPieChart:n,waterLineChart:f}}},J={class:"card-header"},K={class:"card-header"},Q={ref:"electricityPieChart",class:"chart"},X={ref:"electricityLineChart",class:"chart"},Y={ref:"waterPieChart",class:"chart"},Z={ref:"waterLineChart",class:"chart"};function ee(w,r,C,o,L,x){const c=h("el-table-column"),g=h("el-table"),i=h("el-card"),n=h("el-col"),f=h("el-row"),D=h("el-main"),_=h("el-container");return V(),M(_,null,{default:t(()=>[a(D,null,{default:t(()=>[a(f,{gutter:20,class:"row"},{default:t(()=>[a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>[s("div",J,[s("span",null,T(o.buildingName)+"用水情况",1)])]),default:t(()=>[a(g,{data:o.waterTableData,border:"",style:{width:"100%"},height:"300"},{default:t(()=>[a(c,{prop:"floor",label:"楼层",width:"80"}),a(c,{prop:"waterUsage",label:"用水量(吨)"}),a(c,{prop:"waterCost",label:"费用(元)"})]),_:1},8,["data"])]),_:1})]),_:1}),a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>[s("div",K,[s("span",null,T(o.buildingName)+"用电情况",1)])]),default:t(()=>[a(g,{data:o.electricityTableData,border:"",style:{width:"100%"},height:"300"},{default:t(()=>[a(c,{prop:"floor",label:"楼层",width:"80"}),a(c,{prop:"electricityUsage",label:"用电量(度)"}),a(c,{prop:"electricityCost",label:"费用(元)"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),a(f,{gutter:20,class:"row"},{default:t(()=>[a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>r[0]||(r[0]=[s("div",{class:"card-header"},[s("span",null,"每层楼用电分布")],-1)])),default:t(()=>[s("div",Q,null,512)]),_:1})]),_:1}),a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>r[1]||(r[1]=[s("div",{class:"card-header"},[s("span",null,"每层楼用电趋势")],-1)])),default:t(()=>[s("div",X,null,512)]),_:1})]),_:1})]),_:1}),a(f,{gutter:20,class:"row"},{default:t(()=>[a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>r[2]||(r[2]=[s("div",{class:"card-header"},[s("span",null,"每层楼用水分布")],-1)])),default:t(()=>[s("div",Y,null,512)]),_:1})]),_:1}),a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>r[3]||(r[3]=[s("div",{class:"card-header"},[s("span",null,"每层楼用水趋势")],-1)])),default:t(()=>[s("div",Z,null,512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const fe=I(j,[["render",ee],["__scopeId","data-v-c967eb10"]]);export{fe as default};
